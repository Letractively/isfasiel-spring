<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap		
	 PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"		
	 "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="doc">
	<typeAlias alias="hashMap" type="java.util.HashMap"/>
	<insert id="docDAO.insert">
		INSERT INTO TN_DOCUMENT (
			CONTENT_ID
			, BODY
			) 
			VALUES ( 
				#contentId#
				, #body#
			)
	</insert>
	
	<insert id="docDAO,update">
		UPDATE TN_BODY 
		SET BODY = #body#
		WHERE CONTENT_ID = #contentId#
	</insert>
	
	<sql id="docDAO.preList">
		SELECT * FROM  (
			SELECT C.*, ROWNUM RNUM FROM (
	</sql>
	<sql id="docDAO.nextList">
			) C
			WHERE ROWNUM &lt;= #lastIndex#
		)
		WHERE RNUM &gt;= #firstIndex#
	</sql>
	
	<select id="docDAO.list" resultClass="hashMap">
		<include refid="docDAO.preList"/>
		SELECT C.*
		FROM TN_CONTENT C, TN_DOCUMENT D
		WHERE 
			D.CONTENT_ID = C.CONTENT_ID
		<isNotEmpty prepend=" AND " property="title">
			C.TITLE LIKE '%' || #title# || '%'
		</isNotEmpty>
		<isNotEmpty prepend=" AND " property="body">
			D.BODY '%' || #body# || '%'
		</isNotEmpty>
		<include refid="docDAO.nextList"/>
	</select>
	
	<select id="docDAO.select" resultClass="hashMap">
		SELECT C.*
			, D.BODY
		FROM TN_CONTENT C, TN_DOCUMENT D
		WHERE 
			D.CONTENT_ID = C.CONTENT_ID
			AND C.CONTENT_ID = #contentId#
	</select>
</sqlMap>