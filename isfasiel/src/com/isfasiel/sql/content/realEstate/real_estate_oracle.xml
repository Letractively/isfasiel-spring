<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="realEstate">
	<typeAlias alias="hashMap" type="java.util.HashMap"/>
	
	<select id="realEstateDAO.list" resultClass="hashMap">
		SELECT * FROM ( 
			SELECT A.*, ROWNUM RNUM FROM (
				SELECT 
					C.CONTENT_ID, 
					C.TITLE, 
					U.USER_EMAIL, 
					C.VIEW_COUNT, 
					C.CONTENT_TYPE,
					(SELECT COUNT(*) 
						FROM TN_COMMENT CM 
						WHERE	CM = C.CONTENT_ID 
								AND DEL_YN = 'Y'
								AND  STATE = 0) AS CMT_COUNT
				FROM TN_CONTENT C, TN_USER_INFO U, TN_REAL_ESTATE R
				WHERE	R.CONTENT_ID = C.CONTENT_ID
						AND U.USER_IDX = C.USER_IDX
					<isNotEmpty property="title" close="" open="" prepend="AND"> 
						TITLE LIKE '%' || #title# || '%' 
					</isNotEmpty>
					<isNotEmpty property="userEmail" close="" open="" prepend="AND"> 
						U.USER_EMAIL LIKE '%' || #userEmail# || '%' 
					</isNotEmpty>
					<isNotEmpty property="posMaxX" close="" open="" prepend="AND"> 
						R.POS_X &lt;= #posMaxX# AND R.POS_X &gt;= #posMinX#   
					</isNotEmpty>
					<isNotEmpty property="posMaxY" close="" open="" prepend="AND"> 
						R.POS_Y &lt;= #posMaxY# AND R.POS_Y &gt;= #posMinY#   
					</isNotEmpty>
					<isNotEmpty property="suburb" close="" open="" prepend="AND"> 
						 R.SUBURB LIKE '%' || #suburb# || '%'
					</isNotEmpty>
			) A WHERE ROWNUM 
			<![CDATA[<=]]> #lastIndex# ) WHERE RNUM <![CDATA[>=]]> #firstIndex# 
	</select>
	<insert id="realEstateDAO.insert">
		INSERT INTO TN_REAL_ESTATE (
			CONTENT_ID,
			BODY,
			POS_X, 
			POS_Y,
			SUBURB) 
		VALUES ( 
			#contentId#,
			#body#,
			#posX#,
			#posY#,
			#suburb#
		)
	</insert>
	<update id="realEstateDAO.update">
		UPDATE TN_REAL_ESTATE
		SET	BODY	= #body#,
			POS_X	= #posX#,
			POS_Y	= #posY#,
			SUBURB	= #suburb#
		WHERE
			CONTENT_ID = #contentId#
	</update>
	
	<select id="realEstateDAO.select" resultClass="hashMap">
		SELECT C.*
			, R.BODY,
			, R.POS_X
			, R.POS_Y
			, R.SUBURB 
		FROM TN_CONTENT C, TN_REAL_ESTATE R
		WHERE 
			R.CONTENT_ID = C.CONTENT_ID
			AND C.CONTENT_ID = #contentId#
			AND C.DEL_YN = 'N'
			AND C.STATE = 
	</select>
</sqlMap>